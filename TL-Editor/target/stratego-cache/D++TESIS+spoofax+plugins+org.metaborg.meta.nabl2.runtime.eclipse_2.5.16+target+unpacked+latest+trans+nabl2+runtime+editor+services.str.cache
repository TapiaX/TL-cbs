Module("nabl2/runtime/editor/services",[Imports([Import("libspoofax/term/annotation"),Import("libspoofax/editor/resolution"),ImportWildcard("nabl2/runtime/analysis"),ImportWildcard("nabl2/runtime/transform"),ImportWildcard("nabl2/runtime/prelude"),Import("nabl2/runtime/pp"),Import("nabl2/api"),ImportWildcard("signatures/nabl2/runtime/common")]),Rules([RDefNoArgs("nabl2--editor-resolve",Rule(NoAnnoList(Tuple([Var("node"),Wld,Wld,Var("path"),Var("project-path")])),Var("decls"),[WhereClause(Seq(BA(CallNoArgs(SVar("nabl2-get-ast-index")),Var("node")),Assign(Var("a"),App(CallNoArgs(SVar("nabl2-get-ast-analysis")),Var("node"))))),WhereClause(Assign(Var("refs"),App(CallT(SVar("nabl2-get-ast-refs"),[],[Var("a")]),Var("node")))),WhereClause(Not(Assign(NoAnnoList(List([])),Var("refs")))),WithClause(Assign(Var("decls"),App(Seq(Call(SVar("mapconcat"),[Seq(CallT(SVar("nabl2-get-resolved-names"),[],[Var("a")]),Call(SVar("map"),[Seq(CallNoArgs(SVar("Fst")),CallNoArgs(SVar("nabl2--get-occurrence-origin")))]))]),Seq(CallNoArgs(SVar("make-set")),CallNoArgs(SVar("sort-resolutions")))),Var("refs"))))])),RDefNoArgs("nabl2--editor-resolve",Rule(NoAnnoList(Tuple([Var("node"),Wld,Wld,Wld,Wld])),Var("refs"),[WhereClause(Seq(BA(CallNoArgs(SVar("nabl2-get-ast-index")),Var("node")),Assign(Var("a"),App(CallNoArgs(SVar("nabl2-get-ast-analysis")),Var("node"))))),WhereClause(Assign(Var("decls"),App(CallT(SVar("nabl2-get-ast-decls"),[],[Var("a")]),Var("node")))),WhereClause(Not(Assign(NoAnnoList(List([])),Var("decls")))),WithClause(Assign(Var("refs"),App(Seq(Call(SVar("mapconcat"),[Seq(CallT(SVar("nabl2-get-refs-to-decl"),[],[Var("a")]),Call(SVar("map"),[Seq(CallNoArgs(SVar("Fst")),CallNoArgs(SVar("nabl2--get-occurrence-origin")))]))]),Seq(CallNoArgs(SVar("make-set")),CallNoArgs(SVar("sort-resolutions")))),Var("decls"))))])),SDefNoArgs("nabl2--get-occurrence-origin",LChoice(Seq(CallNoArgs(SVar("nabl2-get-occurrence-name")),CallNoArgs(SVar("nabl2-get-ast-index"))),CallNoArgs(SVar("nabl2-get-occurrence-index")))),RDefNoArgs("nabl2--editor-hover",Rule(NoAnnoList(Tuple([Var("node"),Wld,Wld,Var("path"),Var("project-path")])),Var("label"),[WhereClause(Seq(BA(CallNoArgs(SVar("nabl2-get-ast-index")),Var("node")),Assign(Var("a"),App(CallNoArgs(SVar("nabl2-get-ast-analysis")),Var("node"))))),WithClause(Seq(Assign(Var("resource"),Var("path")),Seq(Assign(Var("ast-labels"),App(CallT(SVar("nabl2--ast-hover"),[],[Var("a"),Var("resource")]),Var("node"))),Seq(Assign(Var("decl-labels"),App(CallT(SVar("nabl2--decl-hover"),[],[Var("a"),Var("resource")]),Var("node"))),Assign(Var("labels"),App(CallNoArgs(SVar("conc")),NoAnnoList(Tuple([Var("ast-labels"),Var("decl-labels")])))))))),WhereClause(Not(Assign(NoAnnoList(List([])),Var("labels")))),WithClause(Assign(Var("label"),App(CallNoArgs(SVar("nabl2--lines")),Var("labels"))))])),RDefT("nabl2--ast-hover",[],[DefaultVarDec("a"),DefaultVarDec("resource")],Rule(Var("node"),Var("labels"),[WithClause(CondChoice(Assign(Var("type"),App(CallT(SVar("nabl2-get-ast-type"),[],[Var("a")]),Var("node"))),Assign(Var("labels"),NoAnnoList(List([NoAnnoList(StringQuotation1("                        ",[QStr("Type: "),StringEscape1("                              ",App(CallT(SVar("nabl2--hover-type-string"),[],[Var("resource")]),Var("type")))]))]))),Assign(Var("labels"),NoAnnoList(List([])))))])),RDefT("nabl2--decl-hover",[],[DefaultVarDec("a"),DefaultVarDec("resource")],Rule(Var("node"),Var("labels"),[WithClause(CondChoice(Seq(Assign(Var("decls"),App(CallT(SVar("nabl2-get-ast-decls"),[],[Var("a")]),Var("node"))),Assign(Var("declTypes"),App(Call(SVar("filter"),[Build(NoAnnoList(Tuple([RootApp(Id),RootApp(CallT(SVar("nabl2-get-type"),[],[Var("a")]))])))]),Var("decls")))),Assign(Var("labels"),App(Call(SVar("map"),[LRule(RuleNoCond(NoAnnoList(Tuple([Var("decl"),Var("type")])),NoAnnoList(StringQuotation1("                                              ",[StringEscape1("                                              ",App(CallT(SVar("nabl2--hover-decl-string"),[],[Var("resource")]),Var("decl"))),QStr(" : "),StringEscape1("                                                                                             ",App(CallT(SVar("nabl2--hover-type-string"),[],[Var("resource")]),Var("type")))]))))]),Var("declTypes"))),Assign(Var("labels"),NoAnnoList(List([])))))])),SDefT("nabl2--hover-decl-string",[],[DefaultVarDec("resource")],Call(SVar("nabl2--strict"),[Seq(Call(SVar("topdown"),[Call(SVar("try"),[CallNoArgs(SVar("nabl2--strip-occurrence-index"))])]),Seq(CallT(SVar("nabl2--focus-term"),[],[Var("resource")]),Seq(CallNoArgs(SVar("pp-NaBL2-CTerm")),CallNoArgs(SVar("nabl2--xmlencode")))))])),SDefT("nabl2--hover-type-string",[],[DefaultVarDec("resource")],Call(SVar("nabl2--strict"),[Seq(Call(SVar("topdown"),[Call(SVar("try"),[CallNoArgs(SVar("nabl2--strip-occurrence-index"))])]),Seq(CallT(SVar("nabl2--focus-term"),[],[Var("resource")]),Seq(CallNoArgs(SVar("pp-NaBL2-objlangterm")),CallNoArgs(SVar("nabl2--xmlencode")))))])),SDefNoArgs("nabl2--lines",Call(SVar("nabl2--strict"),[Seq(Call(SVar("separate-by"),[Build(NoAnnoList(Str("\"<br>\"")))]),Seq(BA(CallNoArgs(SVar("conc")),NoAnnoList(Tuple([RootApp(Id),NoAnnoList(List([NoAnnoList(Str("\"<br>\""))]))]))),CallNoArgs(SVar("concat-strings"))))])),SDefNoArgs("nabl2--simplify-ast-indices",Call(SVar("topdown"),[Call(SVar("try"),[CallNoArgs(SVar("nabl2--simplify-ast-index"))])])),RDefNoArgs("nabl2--simplify-ast-index",Rule(AnnoList(Var("t"),[Var(ListVar("a*"))]),AnnoList(Var("t"),[Var("i"),Var(ListVar("a'*"))]),Assign(NoAnnoList(Tuple([NoAnnoList(ListTail([Wld],Wld)),Var(ListVar("a'*"))])),App(Call(SVar("partition"),[Match(NoAnnoList(Op("TermIndex",[Wld,Var("i")])))]),Var(ListVar("a*"))))))])])