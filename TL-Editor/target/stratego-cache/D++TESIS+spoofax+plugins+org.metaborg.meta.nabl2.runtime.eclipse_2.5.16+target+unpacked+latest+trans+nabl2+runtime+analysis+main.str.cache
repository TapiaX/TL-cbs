Module("nabl2/runtime/analysis/main",[Imports([Import("nabl2/api"),ImportWildcard("signatures/nabl2/shared/common"),ImportWildcard("signatures/nabl2/shared/constraints"),ImportWildcard("nabl2/shared"),ImportWildcard("signatures/nabl2/runtime/analysis"),ImportWildcard("signatures/nabl2/runtime/common"),ImportWildcard("nabl2/runtime/analysis"),ImportWildcard("nabl2/runtime/prelude"),ImportWildcard("nabl2/runtime/transform")]),Signature([Constructors([OpDecl("WithCancelProgress",FunType([ConstType(SortNoArgs("Term")),ConstType(SortNoArgs("Cancel")),ConstType(SortNoArgs("Progress"))],ConstType(SortNoArgs("WithCancelProgress"))))])]),Rules([SDefT("nabl2--solve-constraint",[],[DefaultVarDec("config"),DefaultVarDec("cancel"),DefaultVarDec("progress")],BA(Prim("\"SG_solve_single_constraint\"",[Var("config")]),NoAnnoList(Op("WithCancelProgress",[RootApp(Id),Var("cancel"),Var("progress")])))),RDefT("nabl2--analyze-ast",[],[DefaultVarDec("resource")],Rule(Var("ast"),NoAnnoList(Tuple([Var("ast'"),Var("analysis"),Var(ListVar("error*")),Var(ListVar("warning*")),Var(ListVar("note*"))])),[WithClause(Seq(Assign(Var("config"),RootApp(CallNoArgs(SVar("nabl2--analysis-config")))),Seq(Assign(Var("resource'"),App(CallT(SVar("nabl2--set-ast-index"),[],[NoAnnoList(Op("TermIndex",[Var("resource"),NoAnnoList(Int("0"))]))]),Var("resource"))),Seq(CallT(SVar("nabl2--collection-info-msg"),[],[NoAnnoList(StringQuotation1("                                       ",[QStr("Initializing "),StringEscape1("                                                    ",Var("resource"))]))]),Seq(Assign(NoAnnoList(Tuple([Var("params"),Var("C1")])),App(CallT(SVar("nabl2--generate-constraint-init"),[],[Var("resource")]),Var("resource'"))),Seq(Assign(Var("ast'"),App(CallT(SVar("nabl2--index-ast"),[],[Var("resource")]),Var("ast"))),Seq(CallT(SVar("nabl2--collection-info-msg"),[],[NoAnnoList(StringQuotation1("                                       ",[QStr("Generating constraints "),StringEscape1("                                                              ",Var("resource"))]))]),Seq(Assign(Var("C2"),App(CallT(SVar("nabl2--generate-constraint-file"),[],[Var("resource"),Var("params")]),Var("ast'"))),Seq(CallT(SVar("nabl2--collection-info-msg"),[],[NoAnnoList(StringQuotation1("                                       ",[QStr("Solving constraints "),StringEscape1("                                                           ",Var("resource"))]))]),Seq(Assign(NoAnnoList(Tuple([Var("analysis"),Var(ListVar("error*")),Var(ListVar("warning*")),Var(ListVar("note*"))])),App(CallT(SVar("nabl2--solve-constraint"),[],[Var("config"),NoAnnoList(Tuple([])),NoAnnoList(Tuple([]))]),NoAnnoList(Op("CConj",[Var("C1"),Var("C2")])))),CallT(SVar("nabl2--collection-info-msg"),[],[NoAnnoList(StringQuotation1("                                       ",[QStr("Finished analyzing "),StringEscape1("                                                          ",Var("resource"))]))])))))))))))]))]),Rules([SDef("nabl2--analyze",[DefaultVarDec("pre")],Call(SVar("constraint-analysis-compat"),[Call(SVar("nabl2--analyze-compat"),[CallNoArgs(SVar("pre"))])])),RDef("nabl2--analyze-compat",[DefaultVarDec("pre")],Rule(NoAnnoList(Op("AnalyzeUnit",[Var("resource"),Var("ast"),Var("cancel"),Var("progress")])),NoAnnoList(Op("UnitResult",[Var("ast'"),Var("a'"),Var(ListVar("error*")),Var(ListVar("warning*")),Var(ListVar("note*"))])),[WithClause(Seq(Assign(Var("config"),RootApp(CallNoArgs(SVar("nabl2--analysis-config")))),Seq(Assign(Var("resource'"),App(CallT(SVar("nabl2--set-ast-index"),[],[NoAnnoList(Op("TermIndex",[Var("resource"),NoAnnoList(Int("0"))]))]),Var("resource"))),Seq(CallT(SVar("nabl2--collection-info-msg"),[],[NoAnnoList(StringQuotation1("                                       ",[QStr("Initializing "),StringEscape1("                                                    ",Var("resource"))]))]),Seq(Assign(NoAnnoList(Tuple([Var("params"),Var("initial-C")])),App(CallT(SVar("nabl2--generate-constraint-init"),[],[Var("resource")]),Var("resource'"))),Seq(Assign(Var("initial-custom"),App(LChoice(CallNoArgs(SVar("nabl2-custom-analysis-init-hook")),Build(NoAnnoList(Op("None",[])))),NoAnnoList(Tuple([Var("resource"),Var("resource'")])))),Seq(CallT(SVar("nabl2--collection-info-msg"),[],[NoAnnoList(StringQuotation1("                                       ",[QStr("Preprocessing AST "),StringEscape1("                                                         ",Var("resource"))]))]),Seq(Assign(Var("ast'"),App(Seq(CallNoArgs(SVar("pre")),CallT(SVar("nabl2--index-ast"),[],[Var("resource")])),Var("ast"))),Seq(CallT(SVar("nabl2--collection-info-msg"),[],[NoAnnoList(StringQuotation1("                                       ",[QStr("Generating constraints "),StringEscape1("                                                              ",Var("resource"))]))]),Seq(Assign(Var("file-C"),App(CallT(SVar("nabl2--generate-constraint-file"),[],[Var("resource"),Var("params")]),Var("ast'"))),Seq(CallT(SVar("nabl2--collection-info-msg"),[],[NoAnnoList(StringQuotation1("                                       ",[QStr("Solving constraints "),StringEscape1("                                                           ",Var("resource"))]))]),Seq(Assign(NoAnnoList(Tuple([Var("a"),Var(ListVar("constraint-error*")),Var(ListVar("constraint-warning*")),Var(ListVar("constraint-note*"))])),App(CallT(SVar("nabl2--solve-constraint"),[],[Var("config"),Var("cancel"),Var("progress")]),NoAnnoList(Op("CConj",[Var("initial-C"),Var("file-C")])))),Seq(Assign(Var("file-custom"),App(LChoice(CallNoArgs(SVar("nabl2-custom-analysis-unit-hook")),LChoice(CallT(SVar("nabl2-custom-analysis-unit-hook2"),[],[Var("a")]),Build(NoAnnoList(Op("None",[]))))),NoAnnoList(Tuple([Var("resource"),Var("ast'"),Var("initial-custom")])))),Seq(CondChoice(Assign(NoAnnoList(Tuple([Var(ListVar("custom-error*")),Var(ListVar("custom-warning*")),Var(ListVar("custom-note*")),Var("final-custom")])),App(CallT(SVar("nabl2-custom-analysis-final-hook"),[],[Var("a")]),NoAnnoList(Tuple([Var("resource"),Var("initial-custom"),NoAnnoList(List([Var("file-custom")]))])))),Assign(Var("a'"),App(CallT(SVar("nabl2--set-custom-analysis"),[],[Var("a")]),Var("final-custom"))),Assign(NoAnnoList(Tuple([Var(ListVar("custom-error*")),Var(ListVar("custom-warning*")),Var(ListVar("custom-note*")),Var("a'")])),NoAnnoList(Tuple([NoAnnoList(List([])),NoAnnoList(List([])),NoAnnoList(List([])),Var("a")])))),Seq(CallT(SVar("nabl2--collection-info-msg"),[],[NoAnnoList(StringQuotation1("                                       ",[QStr("Finished analyzing "),StringEscape1("                                                          ",Var("resource"))]))]),Seq(Assign(Var(ListVar("error*")),NoAnnoList(List([Var(ListVar("constraint-error*")),Var(ListVar("custom-error*"))]))),Seq(Assign(Var(ListVar("warning*")),NoAnnoList(List([Var(ListVar("constraint-warning*")),Var(ListVar("custom-warning*"))]))),Assign(Var(ListVar("note*")),NoAnnoList(List([Var(ListVar("constraint-note*")),Var(ListVar("custom-note*"))]))))))))))))))))))))]))]),Rules([RDef("nabl2--analyze-compat",[DefaultVarDec("pre")],Rule(NoAnnoList(Op("AnalyzeInitial",[Var("resource"),Var("cancel"),Var("progress")])),NoAnnoList(Op("InitialResult",[Var("initial-result")])),[WithClause(Seq(Assign(Var("config"),RootApp(CallNoArgs(SVar("nabl2--analysis-config")))),Seq(Assign(Var("resource'"),App(CallT(SVar("nabl2--set-ast-index"),[],[NoAnnoList(Op("TermIndex",[Var("resource"),NoAnnoList(Int("0"))]))]),Var("resource"))),Seq(CallT(SVar("nabl2--collection-info-msg"),[],[NoAnnoList(StringQuotation1("                                       ",[QStr("Initializing "),StringEscape1("                                                    ",Var("resource"))]))]),Seq(Assign(NoAnnoList(Tuple([Var("params"),Var("C")])),App(CallT(SVar("nabl2--generate-constraint-init"),[],[Var("resource")]),Var("resource'"))),Seq(Assign(Var("initial-analysis"),App(Prim("\"SG_solve_multi_initial_constraint\"",[Var("config")]),NoAnnoList(Op("WithCancelProgress",[NoAnnoList(Tuple([Var("params"),Var("C")])),Var("cancel"),Var("progress")])))),Seq(CondChoice(Assign(Var("initial-custom"),App(CallNoArgs(SVar("nabl2-custom-analysis-init-hook")),NoAnnoList(Tuple([Var("resource"),Var("resource'")])))),Assign(Var("initial-analysis'"),App(CallT(SVar("nabl2--set-custom-analysis"),[],[Var("initial-analysis")]),Var("initial-custom"))),Assign(Var("initial-analysis'"),Var("initial-analysis"))),Assign(Var("initial-result"),NoAnnoList(Tuple([Var("params"),Var("initial-analysis'")]))))))))))])),RDef("nabl2--analyze-compat",[DefaultVarDec("pre")],Rule(NoAnnoList(Op("AnalyzeUnit",[Var("resource"),Var("ast"),Var("initial-result"),Var("cancel"),Var("progress")])),NoAnnoList(Op("UnitResult",[Var("ast'"),Var("unit-analysis'")])),[WithClause(Seq(Assign(NoAnnoList(Tuple([Var("params"),Var("initial-analysis")])),Var("initial-result")),Assign(Var("initial-custom"),App(LChoice(CallNoArgs(SVar("nabl2--get-custom-analysis")),Build(NoAnnoList(Op("None",[])))),Var("initial-analysis"))))),WithClause(Seq(CallT(SVar("nabl2--collection-info-msg"),[],[NoAnnoList(StringQuotation1("                                       ",[QStr("Preprocessing AST "),StringEscape1("                                                         ",Var("resource"))]))]),Seq(Assign(Var("ast'"),App(Seq(CallNoArgs(SVar("pre")),CallT(SVar("nabl2--index-ast"),[],[Var("resource")])),Var("ast"))),Seq(CallT(SVar("nabl2--collection-info-msg"),[],[NoAnnoList(StringQuotation1("                                       ",[QStr("Generating constraints "),StringEscape1("                                                              ",Var("resource"))]))]),Seq(Assign(Var("C"),App(CallT(SVar("nabl2--generate-constraint-file"),[],[Var("resource"),Var("params")]),Var("ast'"))),Seq(Assign(Var("unit-analysis"),App(PrimNoArgs("\"SG_solve_multi_unit_constraint\""),NoAnnoList(Op("WithCancelProgress",[NoAnnoList(Tuple([Var("initial-analysis"),Var("C")])),Var("cancel"),Var("progress")])))),CondChoice(Assign(Var("unit-custom"),App(LChoice(CallNoArgs(SVar("nabl2-custom-analysis-unit-hook")),CallT(SVar("nabl2-custom-analysis-unit-hook2"),[],[Var("unit-analysis")])),NoAnnoList(Tuple([Var("resource"),Var("ast'"),Var("initial-custom")])))),Assign(Var("unit-analysis'"),App(CallT(SVar("nabl2--set-custom-analysis"),[],[Var("unit-analysis")]),Var("unit-custom"))),Assign(Var("unit-analysis'"),Var("unit-analysis")))))))))])),RDef("nabl2--analyze-compat",[DefaultVarDec("pre")],Rule(NoAnnoList(Op("AnalyzeFinal",[Var("resource"),Var("initial-result"),Var(ListVar("unit-analysis*")),Var("cancel"),Var("progress")])),NoAnnoList(Op("FinalResult",[Var("final-analysis'"),Var(ListVar("error*")),Var(ListVar("warning*")),Var(ListVar("note*"))])),[WithClause(Seq(Assign(NoAnnoList(Tuple([Var("params"),Var("initial-analysis")])),Var("initial-result")),Seq(Assign(Var("initial-custom"),App(LChoice(CallNoArgs(SVar("nabl2--get-custom-analysis")),Build(NoAnnoList(Op("None",[])))),Var("initial-analysis"))),Assign(Var(ListVar("unit-custom*")),App(Call(SVar("filter"),[CallNoArgs(SVar("nabl2--get-custom-analysis"))]),Var(ListVar("unit-analysis*"))))))),WithClause(Seq(CallT(SVar("nabl2--collection-info-msg"),[],[NoAnnoList(StringQuotation1("                                       ",[QStr("Solving constraints "),StringEscape1("                                                           ",Var("resource"))]))]),Seq(Assign(NoAnnoList(Tuple([Var("final-analysis"),Var(ListVar("constraint-error*")),Var(ListVar("constraint-warning*")),Var(ListVar("constraint-note*"))])),App(PrimNoArgs("\"SG_solve_multi_final_constraint\""),NoAnnoList(Op("WithCancelProgress",[NoAnnoList(Tuple([Var("initial-analysis"),Var(ListVar("unit-analysis*"))])),Var("cancel"),Var("progress")])))),Seq(CondChoice(Assign(NoAnnoList(Tuple([Var(ListVar("custom-error*")),Var(ListVar("custom-warning*")),Var(ListVar("custom-note*")),Var("final-custom")])),App(CallT(SVar("nabl2-custom-analysis-final-hook"),[],[Var("final-analysis")]),NoAnnoList(Tuple([Var("resource"),Var("initial-custom"),Var(ListVar("unit-custom*"))])))),Assign(Var("final-analysis'"),App(CallT(SVar("nabl2--set-custom-analysis"),[],[Var("final-analysis")]),Var("final-custom"))),Assign(NoAnnoList(Tuple([Var(ListVar("custom-error*")),Var(ListVar("custom-warning*")),Var(ListVar("custom-note*")),Var("final-analysis'")])),NoAnnoList(Tuple([NoAnnoList(List([])),NoAnnoList(List([])),NoAnnoList(List([])),Var("final-analysis")])))),Seq(CallT(SVar("nabl2--collection-info-msg"),[],[NoAnnoList(StringQuotation1("                                       ",[QStr("Finished analyzing "),StringEscape1("                                                          ",Var("resource"))]))]),Seq(Assign(Var(ListVar("error*")),NoAnnoList(List([Var(ListVar("constraint-error*")),Var(ListVar("custom-error*"))]))),Seq(Assign(Var(ListVar("warning*")),NoAnnoList(List([Var(ListVar("constraint-warning*")),Var(ListVar("custom-warning*"))]))),Assign(Var(ListVar("note*")),NoAnnoList(List([Var(ListVar("constraint-note*")),Var(ListVar("custom-note*"))]))))))))))]))]),Rules([RDefNoArgs("nabl2--analysis-config",Rule(Wld,Var("config"),[WithClause(Seq(Assign(Var("labels"),RootApp(CallNoArgs(SVar("nabl2--labels")))),Seq(Assign(Var("wf"),RootApp(CallNoArgs(SVar("nabl2--labels-wf")))),Seq(Assign(Var("order"),RootApp(CallNoArgs(SVar("nabl2--label-order")))),Seq(Assign(Var("strategy"),RootApp(CallNoArgs(SVar("nabl2--strategy")))),Seq(Assign(Var("path-relevance"),RootApp(CallNoArgs(SVar("nabl2--path-relevance")))),Seq(Assign(Var("res-params"),NoAnnoList(Tuple([Var("labels"),Var("wf"),Var("order"),Var("strategy"),Var("path-relevance")]))),Seq(Assign(Var(ListVar("rel*")),RootApp(CallNoArgs(SVar("nabl2--relations")))),Seq(Assign(Var(ListVar("fun*")),RootApp(CallNoArgs(SVar("nabl2--functions")))),Assign(Var("config"),NoAnnoList(Tuple([Var("res-params"),Var(ListVar("rel*")),Var(ListVar("fun*"))]))))))))))))]))])])